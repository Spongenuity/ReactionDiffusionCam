/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";function e(e,t){var n=e.__state.conversionName.toString(),i=Math.round(e.r),r=Math.round(e.g),o=Math.round(e.b),a=e.a,s=Math.round(e.h),u=e.s.toFixed(1),l=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var c=e.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return"CSS_RGB"===n?"rgb("+i+","+r+","+o+")":"CSS_RGBA"===n?"rgba("+i+","+r+","+o+","+a+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+i+","+r+","+o+"]":"RGBA_ARRAY"===n?"["+i+","+r+","+o+","+a+"]":"RGB_OBJ"===n?"{r:"+i+",g:"+r+",b:"+o+"}":"RGBA_OBJ"===n?"{r:"+i+",g:"+r+",b:"+o+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+u+",v:"+l+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+u+",v:"+l+",a:"+a+"}":"unknown format"}var t=Array.prototype.forEach,n=Array.prototype.slice,i={BREAK:{},extend:function(e){return this.each(n.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))}),this),e},defaults:function(e){return this.each(n.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))}),this),e},compose:function(){var e=n.call(arguments);return function(){for(var t=n.call(arguments),i=e.length-1;i>=0;i--)t=[e[i].apply(this,t)];return t[0]}},each:function(e,n,i){if(e)if(t&&e.forEach&&e.forEach===t)e.forEach(n,i);else if(e.length===e.length+0){var r,o=void 0;for(o=0,r=e.length;o<r;o++)if(o in e&&n.call(i,e[o],o)===this.BREAK)return}else for(var a in e)if(n.call(i,e[a],a)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var i=void 0;return function(){var r=this,o=arguments,a=n||!i;clearTimeout(i),i=setTimeout((function(){i=null,n||e.apply(r,o)}),t),a&&e.apply(r,o)}},toArray:function(e){return e.toArray?e.toArray():n.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return isNaN(e)})),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return e instanceof Function}},r=[{litmus:i.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:e},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:e},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:e},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:e}}},{litmus:i.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:i.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:i.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(i.isNumber(e.r)&&i.isNumber(e.g)&&i.isNumber(e.b)&&i.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(i.isNumber(e.r)&&i.isNumber(e.g)&&i.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(i.isNumber(e.h)&&i.isNumber(e.s)&&i.isNumber(e.v)&&i.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(i.isNumber(e.h)&&i.isNumber(e.s)&&i.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],o=void 0,a=void 0,s=function(){a=!1;var e=arguments.length>1?i.toArray(arguments):arguments[0];return i.each(r,(function(t){if(t.litmus(e))return i.each(t.conversions,(function(t,n){if(o=t.read(e),!1===a&&!1!==o)return a=o,o.conversionName=n,o.conversion=t,i.BREAK})),i.BREAK})),a},u=void 0,l={hsv_to_rgb:function(e,t,n){var i=Math.floor(e/60)%6,r=e/60-Math.floor(e/60),o=n*(1-t),a=n*(1-r*t),s=n*(1-(1-r)*t),u=[[n,s,o],[a,n,o],[o,n,s],[o,a,n],[s,o,n],[n,o,a]][i];return{r:255*u[0],g:255*u[1],b:255*u[2]}},rgb_to_hsv:function(e,t,n){var i=Math.min(e,t,n),r=Math.max(e,t,n),o=r-i,a=void 0;return 0===r?{h:NaN,s:0,v:0}:(a=e===r?(t-n)/o:t===r?2+(n-e)/o:4+(e-t)/o,(a/=6)<0&&(a+=1),{h:360*a,s:o/r,v:r/255})},rgb_to_hex:function(e,t,n){var i=this.hex_with_component(0,2,e);return i=this.hex_with_component(i,1,t),this.hex_with_component(i,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(u=8*t)|e&~(255<<u)}},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},h=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),f=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in r)return r.value;var a=r.get;return void 0!==a?a.call(i):void 0},p=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},_=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},m=function(){function t(){if(d(this,t),this.__state=s.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return h(t,[{key:"toString",value:function(){return e(this)}},{key:"toHexString",value:function(){return e(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function g(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||m.recalculateRGB(this,t,n),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(m.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function v(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||m.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(m.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}m.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=l.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");i.extend(e.__state,l.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},m.recalculateHSV=function(e){var t=l.rgb_to_hsv(e.r,e.g,e.b);i.extend(e.__state,{s:t.s,v:t.v}),i.isNaN(t.h)?i.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},m.COMPONENTS=["r","g","b","h","s","v","hex","a"],g(m.prototype,"r",2),g(m.prototype,"g",1),g(m.prototype,"b",0),v(m.prototype,"h"),v(m.prototype,"s"),v(m.prototype,"v"),Object.defineProperty(m.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(m.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=l.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var b=function(){function e(t,n){d(this,e),this.initialValue=t[n],this.domElement=document.createElement("div"),this.object=t,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return h(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),y={};i.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(e,t){i.each(e,(function(e){y[e]=t}))}));var x=/(\d+(\.\d+)?)px/;function w(e){if("0"===e||i.isUndefined(e))return 0;var t=e.match(x);return i.isNull(t)?0:parseFloat(t[1])}var E={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var r=n,o=t;i.isUndefined(o)&&(o=!0),i.isUndefined(r)&&(r=!0),e.style.position="absolute",o&&(e.style.left=0,e.style.right=0),r&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,r){var o=n||{},a=y[t];if(!a)throw new Error("Event type "+t+" not supported.");var s=document.createEvent(a);switch(a){case"MouseEvents":var u=o.x||o.clientX||0,l=o.y||o.clientY||0;s.initMouseEvent(t,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,u,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=s.initKeyboardEvent||s.initKeyEvent;i.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(t,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break;default:s.initEvent(t,o.bubbles||!1,o.cancelable||!0)}i.defaults(s,r),e.dispatchEvent(s)},bind:function(e,t,n,i){var r=i||!1;return e.addEventListener?e.addEventListener(t,n,r):e.attachEvent&&e.attachEvent("on"+t,n),E},unbind:function(e,t,n,i){var r=i||!1;return e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent&&e.detachEvent("on"+t,n),E},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1===n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return E},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),i=n.indexOf(t);-1!==i&&(n.splice(i,1),e.className=n.join(" "))}else e.className=void 0;return E},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return w(t["border-left-width"])+w(t["border-right-width"])+w(t["padding-left"])+w(t["padding-right"])+w(t.width)},getHeight:function(e){var t=getComputedStyle(e);return w(t["border-top-width"])+w(t["border-bottom-width"])+w(t["padding-top"])+w(t["padding-bottom"])+w(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do{n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent}while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},S=function(e){function t(e,n){d(this,t);var i=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),r=i;return i.__prev=i.getValue(),i.__checkbox=document.createElement("input"),i.__checkbox.setAttribute("type","checkbox"),E.bind(i.__checkbox,"change",(function(){r.setValue(!r.__prev)}),!1),i.domElement.appendChild(i.__checkbox),i.updateDisplay(),i}return p(t,e),h(t,[{key:"setValue",value:function(e){var n=f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(b),A=function(e){function t(e,n,r){d(this,t);var o=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),a=r,s=o;if(o.__select=document.createElement("select"),i.isArray(a)){var u={};i.each(a,(function(e){u[e]=e})),a=u}return i.each(a,(function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),s.__select.appendChild(n)})),o.updateDisplay(),E.bind(o.__select,"change",(function(){var e=this.options[this.selectedIndex].value;s.setValue(e)})),o.domElement.appendChild(o.__select),o}return p(t,e),h(t,[{key:"setValue",value:function(e){var n=f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return E.isActive(this.__select)?this:(this.__select.value=this.getValue(),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(b),T=function(e){function t(e,n){d(this,t);var i=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),r=i;function o(){r.setValue(r.__input.value)}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),E.bind(i.__input,"keyup",o),E.bind(i.__input,"change",o),E.bind(i.__input,"blur",(function(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())})),E.bind(i.__input,"keydown",(function(e){13===e.keyCode&&this.blur()})),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return p(t,e),h(t,[{key:"updateDisplay",value:function(){return E.isActive(this.__input)||(this.__input.value=this.getValue()),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(b);function C(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var k=function(e){function t(e,n,r){d(this,t);var o=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),a=r||{};return o.__min=a.min,o.__max=a.max,o.__step=a.step,i.isUndefined(o.__step)?0===o.initialValue?o.__impliedStep=1:o.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__impliedStep=o.__step,o.__precision=C(o.__impliedStep),o}return p(t,e),h(t,[{key:"setValue",value:function(e){var n=e;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=C(e),this}}]),t}(b),I=function(e){function t(e,n,r){d(this,t);var o=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));o.__truncationSuspended=!1;var a=o,s=void 0;function u(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function l(e){var t=s-e.clientY;a.setValue(a.getValue()+t*a.__impliedStep),s=e.clientY}function c(){E.unbind(window,"mousemove",l),E.unbind(window,"mouseup",c),u()}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),E.bind(o.__input,"change",(function(){var e=parseFloat(a.__input.value);i.isNaN(e)||a.setValue(e)})),E.bind(o.__input,"blur",(function(){u()})),E.bind(o.__input,"mousedown",(function(e){E.bind(window,"mousemove",l),E.bind(window,"mouseup",c),s=e.clientY})),E.bind(o.__input,"keydown",(function(e){13===e.keyCode&&(a.__truncationSuspended=!0,this.blur(),a.__truncationSuspended=!1,u())})),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return p(t,e),h(t,[{key:"updateDisplay",value:function(){var e,n,i;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),n=this.__precision,i=Math.pow(10,n),Math.round(e*i)/i),f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(k);function R(e,t,n,i,r){return i+(e-t)/(n-t)*(r-i)}var O=function(e){function t(e,n,i,r,o){d(this,t);var a=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,{min:i,max:r,step:o})),s=a;function u(e){e.preventDefault();var t=s.__background.getBoundingClientRect();return s.setValue(R(e.clientX,t.left,t.right,s.__min,s.__max)),!1}function l(){E.unbind(window,"mousemove",u),E.unbind(window,"mouseup",l),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function c(e){var t=e.touches[0].clientX,n=s.__background.getBoundingClientRect();s.setValue(R(t,n.left,n.right,s.__min,s.__max))}function h(){E.unbind(window,"touchmove",c),E.unbind(window,"touchend",h),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),E.bind(a.__background,"mousedown",(function(e){document.activeElement.blur(),E.bind(window,"mousemove",u),E.bind(window,"mouseup",l),u(e)})),E.bind(a.__background,"touchstart",(function(e){1===e.touches.length&&(E.bind(window,"touchmove",c),E.bind(window,"touchend",h),c(e))})),E.addClass(a.__background,"slider"),E.addClass(a.__foreground,"slider-fg"),a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return p(t,e),h(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",f(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(k),L=function(e){function t(e,n,i){d(this,t);var r=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=r;return r.__button=document.createElement("div"),r.__button.innerHTML=void 0===i?"Fire":i,E.bind(r.__button,"click",(function(e){return e.preventDefault(),o.fire(),!1})),E.addClass(r.__button,"button"),r.domElement.appendChild(r.__button),r}return p(t,e),h(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(b),P=function(e){function t(e,n){d(this,t);var r=_(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));r.__color=new m(r.getValue()),r.__temp=new m(0);var o=r;r.domElement=document.createElement("div"),E.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",E.bind(r.__input,"keydown",(function(e){13===e.keyCode&&p.call(this)})),E.bind(r.__input,"blur",p),E.bind(r.__selector,"mousedown",(function(){E.addClass(this,"drag").bind(window,"mouseup",(function(){E.removeClass(o.__selector,"drag")}))})),E.bind(r.__selector,"touchstart",(function(){E.addClass(this,"drag").bind(window,"touchend",(function(){E.removeClass(o.__selector,"drag")}))}));var a,u=document.createElement("div");function l(e){v(e),E.bind(window,"mousemove",v),E.bind(window,"touchmove",v),E.bind(window,"mouseup",h),E.bind(window,"touchend",h)}function c(e){b(e),E.bind(window,"mousemove",b),E.bind(window,"touchmove",b),E.bind(window,"mouseup",f),E.bind(window,"touchend",f)}function h(){E.unbind(window,"mousemove",v),E.unbind(window,"touchmove",v),E.unbind(window,"mouseup",h),E.unbind(window,"touchend",h),g()}function f(){E.unbind(window,"mousemove",b),E.unbind(window,"touchmove",b),E.unbind(window,"mouseup",f),E.unbind(window,"touchend",f),g()}function p(){var e=s(this.value);!1!==e?(o.__color.__state=e,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function g(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}function v(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,i=n.clientX,r=n.clientY,a=(i-t.left)/(t.right-t.left),s=1-(r-t.top)/(t.bottom-t.top);return s>1?s=1:s<0&&(s=0),a>1?a=1:a<0&&(a=0),o.__color.v=s,o.__color.s=a,o.setValue(o.__color.toOriginal()),!1}function b(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__hue_field.getBoundingClientRect(),n=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return n>1?n=1:n<0&&(n=0),o.__color.h=360*n,o.setValue(o.__color.toOriginal()),!1}return i.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),i.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),i.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),i.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),i.extend(u.style,{width:"100%",height:"100%",background:"none"}),F(u,"top","rgba(0,0,0,0)","#000"),i.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(a=r.__hue_field).style.background="",a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",i.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),E.bind(r.__saturation_field,"mousedown",l),E.bind(r.__saturation_field,"touchstart",l),E.bind(r.__field_knob,"mousedown",l),E.bind(r.__field_knob,"touchstart",l),E.bind(r.__hue_field,"mousedown",c),E.bind(r.__hue_field,"touchstart",c),r.__saturation_field.appendChild(u),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay(),r}return p(t,e),h(t,[{key:"updateDisplay",value:function(){var e=s(this.getValue());if(!1!==e){var t=!1;i.each(m.COMPONENTS,(function(n){if(!i.isUndefined(e[n])&&!i.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}}),this),t&&i.extend(this.__color.__state,e)}i.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,r=255-n;i.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,F(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),i.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),t}(b),B=["-moz-","-o-","-webkit-","-ms-",""];function F(e,t,n,r){e.style.background="",i.each(B,(function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+n+" 0%, "+r+" 100%); "}))}var D=function(e,t){var n=e[t];return i.isArray(arguments[2])||i.isObject(arguments[2])?new A(e,t,arguments[2]):i.isNumber(n)?i.isNumber(arguments[2])&&i.isNumber(arguments[3])?i.isNumber(arguments[4])?new O(e,t,arguments[2],arguments[3],arguments[4]):new O(e,t,arguments[2],arguments[3]):i.isNumber(arguments[4])?new I(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new I(e,t,{min:arguments[2],max:arguments[3]}):i.isString(n)?new T(e,t):i.isFunction(n)?new L(e,t,""):i.isBoolean(n)?new S(e,t):null},M=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},N=function(){function e(){d(this,e),this.backgroundElement=document.createElement("div"),i.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),E.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),i.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;E.bind(this.backgroundElement,"click",(function(){t.hide()}))}return h(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),i.defer((function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",E.unbind(e.domElement,"webkitTransitionEnd",t),E.unbind(e.domElement,"transitionend",t),E.unbind(e.domElement,"oTransitionEnd",t)};E.bind(this.domElement,"webkitTransitionEnd",t),E.bind(this.domElement,"transitionend",t),E.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-E.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-E.getHeight(this.domElement)/2+"px"}}]),e}();!function(e,t){var n=t||document,i=document.createElement("style");i.type="text/css",i.innerHTML=e;var r=n.getElementsByTagName("head")[0];try{r.appendChild(i)}catch(e){}}(function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var U="Default",V=function(){try{return!!window.localStorage}catch(e){return!1}}(),H=void 0,j=!0,z=void 0,G=!1,X=[],W=function e(t){var n=this,r=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),E.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=i.defaults(r,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),r=i.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),i.isUndefined(r.load)?r.load={preset:U}:r.preset&&(r.load.preset=r.preset),i.isUndefined(r.parent)&&r.hideable&&X.push(this),r.resizable=i.isUndefined(r.parent)&&r.resizable,r.autoPlace&&i.isUndefined(r.scrollable)&&(r.scrollable=!0);var o,a=V&&"true"===localStorage.getItem(Z(0,"isLocal")),s=void 0,u=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:r.load.preset},set:function(e){n.parent?n.getRoot().preset=e:r.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),n.revert()}},width:{get:function(){return r.width},set:function(e){r.width=e,ne(n,e)}},name:{get:function(){return r.name},set:function(e){r.name=e,u&&(u.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(t){r.closed=t,r.closed?E.addClass(n.__ul,e.CLASS_CLOSED):E.removeClass(n.__ul,e.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return a},set:function(e){V&&(a=e,e?E.bind(window,"unload",s):E.unbind(window,"unload",s),localStorage.setItem(Z(0,"isLocal"),e))}}}),i.isUndefined(r.parent)){if(this.closed=r.closed||!1,E.addClass(this.domElement,e.CLASS_MAIN),E.makeSelectable(this.domElement,!1),V&&a){n.useLocalStorage=!0;var l=localStorage.getItem(Z(0,"gui"));l&&(r.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,E.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),r.closeOnTop?(E.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(E.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),E.bind(this.__closeButton,"click",(function(){n.closed=!n.closed}))}else{void 0===r.closed&&(r.closed=!0);var c=document.createTextNode(r.name);E.addClass(c,"controller-name"),u=Y(n,c),E.addClass(this.__ul,e.CLASS_CLOSED),E.addClass(u,"title"),E.bind(u,"click",(function(e){return e.preventDefault(),n.closed=!n.closed,!1})),r.closed||(this.closed=!1)}r.autoPlace&&(i.isUndefined(r.parent)&&(j&&(z=document.createElement("div"),E.addClass(z,"dg"),E.addClass(z,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(z),j=!1),z.appendChild(this.domElement),E.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||ne(n,r.width)),this.__resizeHandler=function(){n.onResizeDebounced()},E.bind(window,"resize",this.__resizeHandler),E.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),E.bind(this.__ul,"transitionend",this.__resizeHandler),E.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&te(this),s=function(){V&&"true"===localStorage.getItem(Z(0,"isLocal"))&&localStorage.setItem(Z(0,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=s,r.parent||((o=n.getRoot()).width+=1,i.defer((function(){o.width-=1})))};function Y(e,t,n){var i=document.createElement("li");return t&&i.appendChild(t),n?e.__ul.insertBefore(i,n):e.__ul.appendChild(i),e.onResize(),i}function K(e){E.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&E.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function J(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function Q(e,t){var n=e.getRoot(),i=n.__rememberedObjects.indexOf(t.object);if(-1!==i){var r=n.__rememberedObjectIndecesToControllers[i];if(void 0===r&&(r={},n.__rememberedObjectIndecesToControllers[i]=r),r[t.property]=t,n.load&&n.load.remembered){var o=n.load.remembered,a=void 0;if(o[e.preset])a=o[e.preset];else{if(!o[U])return;a=o[U]}if(a[i]&&void 0!==a[i][t.property]){var s=a[i][t.property];t.initialValue=s,t.setValue(s)}}}}function q(e,t,n,r){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var o=void 0;if(r.color)o=new P(t,n);else{var a=[t,n].concat(r.factoryArgs);o=D.apply(e,a)}r.before instanceof b&&(r.before=r.before.__li),Q(e,o),E.addClass(o.domElement,"c");var s=document.createElement("span");E.addClass(s,"property-name"),s.innerHTML=o.property;var u=document.createElement("div");u.appendChild(s),u.appendChild(o.domElement);var l=Y(e,u,r.before);return E.addClass(l,W.CLASS_CONTROLLER_ROW),o instanceof P?E.addClass(l,"color"):E.addClass(l,c(o.getValue())),function(e,t,n){if(n.__li=t,n.__gui=e,i.extend(n,{options:function(t){if(arguments.length>1){var r=n.__li.nextElementSibling;return n.remove(),q(e,n.object,n.property,{before:r,factoryArgs:[i.toArray(arguments)]})}if(i.isArray(t)||i.isObject(t)){var o=n.__li.nextElementSibling;return n.remove(),q(e,n.object,n.property,{before:o,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof O){var r=new I(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});i.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(e){var t=n[e],i=r[e];n[e]=r[e]=function(){var e=Array.prototype.slice.call(arguments);return i.apply(r,e),t.apply(n,e)}})),E.addClass(t,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof I){var o=function(t){if(i.isNumber(n.__min)&&i.isNumber(n.__max)){var r=n.__li.firstElementChild.firstElementChild.innerHTML,o=n.__gui.__listening.indexOf(n)>-1;n.remove();var a=q(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return a.name(r),o&&a.listen(),a}return t};n.min=i.compose(o,n.min),n.max=i.compose(o,n.max)}else n instanceof S?(E.bind(t,"click",(function(){E.fakeEvent(n.__checkbox,"click")})),E.bind(n.__checkbox,"click",(function(e){e.stopPropagation()}))):n instanceof L?(E.bind(t,"click",(function(){E.fakeEvent(n.__button,"click")})),E.bind(t,"mouseover",(function(){E.addClass(n.__button,"hover")})),E.bind(t,"mouseout",(function(){E.removeClass(n.__button,"hover")}))):n instanceof P&&(E.addClass(t,"color"),n.updateDisplay=i.compose((function(e){return t.style.borderLeftColor=n.__color.toString(),e}),n.updateDisplay),n.updateDisplay());n.setValue=i.compose((function(t){return e.getRoot().__preset_select&&n.isModified()&&J(e.getRoot(),!0),t}),n.setValue)}(e,l,o),e.__controllers.push(o),o}function Z(e,t){return document.location.href+"."+t}function $(e,t,n){var i=document.createElement("option");i.innerHTML=t,i.value=t,e.__preset_select.appendChild(i),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function ee(e,t){t.style.display=e.useLocalStorage?"block":"none"}function te(e){var t=void 0;function n(n){return n.preventDefault(),e.width+=t-n.clientX,e.onResize(),t=n.clientX,!1}function r(){E.removeClass(e.__closeButton,W.CLASS_DRAG),E.unbind(window,"mousemove",n),E.unbind(window,"mouseup",r)}function o(i){return i.preventDefault(),t=i.clientX,E.addClass(e.__closeButton,W.CLASS_DRAG),E.bind(window,"mousemove",n),E.bind(window,"mouseup",r),!1}e.__resize_handle=document.createElement("div"),i.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),E.bind(e.__resize_handle,"mousedown",o),E.bind(e.__closeButton,"mousedown",o),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function ne(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function ie(e,t){var n={};return i.each(e.__rememberedObjects,(function(r,o){var a={},s=e.__rememberedObjectIndecesToControllers[o];i.each(s,(function(e,n){a[n]=t?e.initialValue:e.getValue()})),n[o]=a})),n}function re(e){0!==e.length&&M.call(window,(function(){re(e)})),i.each(e,(function(e){e.updateDisplay()}))}W.toggleHide=function(){G=!G,i.each(X,(function(e){e.domElement.style.display=G?"none":""}))},W.CLASS_AUTO_PLACE="a",W.CLASS_AUTO_PLACE_CONTAINER="ac",W.CLASS_MAIN="main",W.CLASS_CONTROLLER_ROW="cr",W.CLASS_TOO_TALL="taller-than-window",W.CLASS_CLOSED="closed",W.CLASS_CLOSE_BUTTON="close-button",W.CLASS_CLOSE_TOP="close-top",W.CLASS_CLOSE_BOTTOM="close-bottom",W.CLASS_DRAG="drag",W.DEFAULT_WIDTH=245,W.TEXT_CLOSED="Close Controls",W.TEXT_OPEN="Open Controls",W._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||W.toggleHide()},E.bind(window,"keydown",W._keydownHandler,!1),i.extend(W.prototype,{add:function(e,t){return q(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return q(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;i.defer((function(){t.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&z.removeChild(this.domElement);var e=this;i.each(this.__folders,(function(t){e.removeFolder(t)})),E.unbind(window,"keydown",W._keydownHandler,!1),K(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new W(t);this.__folders[e]=n;var i=Y(this,n.domElement);return E.addClass(i,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],K(e);var t=this;i.each(e.__folders,(function(t){e.removeFolder(t)})),i.defer((function(){t.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=E.getOffset(e.__ul).top,n=0;i.each(e.__ul.childNodes,(function(t){e.autoPlace&&t===e.__save_row||(n+=E.getHeight(t))})),window.innerHeight-t-20<n?(E.addClass(e.domElement,W.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(E.removeClass(e.domElement,W.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&i.defer((function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"})),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:i.debounce((function(){this.onResize()}),50),remember:function(){if(i.isUndefined(H)&&((H=new N).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;i.each(Array.prototype.slice.call(arguments),(function(t){0===e.__rememberedObjects.length&&function(e){var t=e.__save_row=document.createElement("li");E.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),E.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",E.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",E.addClass(r,"button"),E.addClass(r,"save");var o=document.createElement("span");o.innerHTML="New",E.addClass(o,"button"),E.addClass(o,"save-as");var a=document.createElement("span");a.innerHTML="Revert",E.addClass(a,"button"),E.addClass(a,"revert");var s=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?i.each(e.load.remembered,(function(t,n){$(e,n,n===e.preset)})):$(e,U,!1),E.bind(s,"change",(function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value})),t.appendChild(s),t.appendChild(n),t.appendChild(r),t.appendChild(o),t.appendChild(a),V){var u=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(Z(0,"isLocal"))&&l.setAttribute("checked","checked"),ee(e,u),E.bind(l,"change",(function(){e.useLocalStorage=!e.useLocalStorage,ee(e,u)}))}var c=document.getElementById("dg-new-constructor");E.bind(c,"keydown",(function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||H.hide()})),E.bind(n,"click",(function(){c.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),H.show(),c.focus(),c.select()})),E.bind(r,"click",(function(){e.save()})),E.bind(o,"click",(function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)})),E.bind(a,"click",(function(){e.revert()}))}(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)})),this.autoPlace&&ne(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=ie(this)),e.folders={},i.each(this.__folders,(function(t,n){e.folders[n]=t.getSaveObject()})),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=ie(this),J(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[U]=ie(this,!0)),this.load.remembered[e]=ie(this),this.preset=e,$(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){i.each(this.__controllers,(function(t){this.getRoot().load.remembered?Q(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())}),this),i.each(this.__folders,(function(e){e.revert(e)})),e||J(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&re(this.__listening)},updateDisplay:function(){i.each(this.__controllers,(function(e){e.updateDisplay()})),i.each(this.__folders,(function(e){e.updateDisplay()}))}});var oe=W;function ae(){ae=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function c(e,t,n,i){var o=t&&t.prototype instanceof g?t:g,a=Object.create(o.prototype),s=new R(i||[]);return r(a,"_invoke",{value:T(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var h="suspendedStart",f="suspendedYield",p="executing",_="completed",m={};function g(){}function v(){}function b(){}var y={};l(y,a,(function(){return this}));var x=Object.getPrototypeOf,w=x&&x(x(O([])));w&&w!==n&&i.call(w,a)&&(y=w);var E=b.prototype=g.prototype=Object.create(y);function S(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function A(e,t){function n(r,o,a,s){var u=d(e[r],e,o);if("throw"!==u.type){var l=u.arg,c=l.value;return c&&"object"==se(c)&&i.call(c,"__await")?t.resolve(c.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(c).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,s)}))}s(u.arg)}var o;r(this,"_invoke",{value:function(e,i){function r(){return new t((function(t,r){n(e,i,t,r)}))}return o=o?o.then(r,r):r()}})}function T(t,n,i){var r=h;return function(o,a){if(r===p)throw Error("Generator is already running");if(r===_){if("throw"===o)throw a;return{value:e,done:!0}}for(i.method=o,i.arg=a;;){var s=i.delegate;if(s){var u=C(s,i);if(u){if(u===m)continue;return u}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===h)throw r=_,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=p;var l=d(t,n,i);if("normal"===l.type){if(r=i.done?_:f,l.arg===m)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(r=_,i.method="throw",i.arg=l.arg)}}}function C(t,n){var i=n.method,r=t.iterator[i];if(r===e)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=e,C(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),m;var o=d(r,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,m;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function O(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(se(t)+" is not iterable")}return v.prototype=b,r(E,"constructor",{value:b,configurable:!0}),r(b,"constructor",{value:v,configurable:!0}),v.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(E),e},t.awrap=function(e){return{__await:e}},S(A.prototype),l(A.prototype,s,(function(){return this})),t.AsyncIterator=A,t.async=function(e,n,i,r,o){void 0===o&&(o=Promise);var a=new A(c(e,n,i,r),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(E),l(E,u,"Generator"),l(E,a,(function(){return this})),l(E,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=O,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(I),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(i,r){return s.type="throw",s.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var u=i.call(a,"catchLoc"),l=i.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;I(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:O(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),m}},t}function se(e){return se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},se(e)}function ue(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return le(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?le(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function le(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function ce(){return ce="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=fe(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},ce.apply(null,arguments)}function de(e,t,n){return t=fe(t),function(e,t){if(t&&("object"==se(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,he()?Reflect.construct(t,n||[],fe(e).constructor):t.apply(e,n))}function he(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(he=function(){return!!e})()}function fe(e){return fe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},fe(e)}function pe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_e(e,t)}function _e(e,t){return _e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_e(e,t)}function me(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ge(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,we(i.key),i)}}function ve(e,t,n){return t&&ge(e.prototype,t),n&&ge(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function be(e,t,n,i,r,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(i,r)}function ye(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function a(e){be(o,i,r,a,s,"next",e)}function s(e){be(o,i,r,a,s,"throw",e)}a(void 0)}))}}function xe(e,t,n){return(t=we(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function we(e){var t=function(e){if("object"!=se(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=se(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==se(t)?t:t+""}var Ee,Se=document.createElement("canvas");document.documentElement.appendChild(Se);var Ae,Te=xe(xe({aspectRatio:4/3,canvasWidth:1024,randomPatternScale:5,zoom:1,interface:"image",initState:"starter",maxResolution:8,invert:1,speed:60,patternSplit:7,contrast:75,zoomCam:2,edgeInfluence:0,brightnessInfluence:0,patternScale:4,brushSize:.01,brushStrength:1},"contrast",75),"threshold",128);function Ce(){return(Ce=ye(ae().mark((function e(){var t,n;return ae().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.createElement("video"),e.prev=1,navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){e.next=4;break}throw new Error("Your browser does not support the required media APIs");case 4:return console.log("Attempting to get user media..."),e.next=7,navigator.mediaDevices.getUserMedia({video:!0});case 7:return n=e.sent,console.log("User media obtained successfully"),t.srcObject=n,console.log("Video source object set"),e.next=13,t.play();case 13:return console.log("Video playback initiated"),e.abrupt("return",t);case 17:return e.prev=17,e.t0=e.catch(1),console.error("Detailed error in setupCamera:",e.t0),displayErrorMessage("Camera access is not available. Please check your browser settings and ensure you're using a secure connection (HTTPS)."),e.abrupt("return",null);case 22:case"end":return e.stop()}}),e,null,[[1,17]])})))).apply(this,arguments)}function ke(){if(Ae)try{var e=Ae.captureVideoFrame();e?null===Ue?Ue=new He(e):Ue.uploadToGPU(e):console.error("Failed to capture video frame")}catch(e){console.error("Error in updateTexture:",e)}else console.log("No camera input available")}(function(){return Ce.apply(this,arguments)})().then((function(e){e?(console.log("Camera input successfully set up"),Ae={video:e,captureVideoFrame:function(){var t=document.createElement("canvas");t.width=Te.canvasWidth,t.height=Te.canvasHeight;var n,i,r,o,a=t.getContext("2d"),s=e.videoWidth/e.videoHeight,u=t.width/t.height;s>u?(r=(o=e.videoHeight)*u,i=0,n=(e.videoWidth-r)/2):(o=(r=e.videoWidth)/u,n=0,i=(e.videoHeight-o)/2);var l=r/Te.zoomCam,c=o/Te.zoomCam;n+=(r-l)/2,i+=(o-c)/2,r=l,o=c,a.save(),a.scale(-1,-1),a.translate(-t.width,-t.height),a.drawImage(e,n,i,r,o,0,0,t.width,t.height),a.restore(),Te.invert&&(a.globalCompositeOperation="difference",a.fillStyle="white",a.fillRect(0,0,t.width,t.height));for(var d=a.getImageData(0,0,t.width,t.height),h=d.data,f=259*(Te.contrast+255)/(255*(259-Te.contrast)),p=0;p<h.length;p+=4)h[p]=f*(h[p]-128)+128,h[p+1]=f*(h[p+1]-128)+128,h[p+2]=f*(h[p+2]-128)+128;return a.putImageData(d,0,0),t},setZoom:function(e){Te.zoomCam=e}}):console.error("Failed to set up camera input")})).catch((function(e){console.error("Unexpected error in setupCamera:",e),displayErrorMessage("An unexpected error occurred while setting up the camera.")})),Te.canvasHeight=Math.round(Te.canvasWidth/Te.aspectRatio);var Ie="\n    float de16(vec2 v) {\n        return dot(v, vec2(255.0 / 256.0, 1.0 / 256.0));\n    }\n    vec2 en16(float f) {\n        f = 255.99 * clamp(f, 0.0, 1.0);\n        return vec2(floor(f) / 255.0, fract(f));\n    }\n    ",Re="\n    vec2 de(vec4 encoded) {\n        return vec2(de16(encoded.rg), de16(encoded.ba));\n    }\n    vec4 en(vec2 decoded) {\n        return vec4(en16(decoded.x), en16(decoded.y));\n    }\n    float samT(sampler2D tex, vec2 position) {\n        vec4 sTex = texture(tex, position);\n        return de(sTex).y;\n    }\n    ",Oe={disVert:"#version 300 es\n    uniform vec2 s;\n    uniform float z;\n    in vec2 co;\n    out vec2 vS;\n    void main(void) {\n        gl_Position = vec4(co * s * z, 0, 1);\n        vS = 0.5 + 0.5 * co;\n    }\n    ",disColFrag:"#version 300 es\n    precision mediump float;\n    uniform sampler2D uR, uG, uB;\n    in vec2 vS;  \n    out vec4 fragColor;\n    ".concat(Ie,"\n    ").concat(Re,"\n    \n    void main() {\n        float red = samT(uR, vS);\n        float green = samT(uG, vS);\n        float blue = samT(uB, vS);\n    \n        vec3 edge0 = vec3(0.20, 0.21, 0.22);\n        vec3 edge1 = vec3(0.23, 0.24, 0.25);\n        vec3 smoothColor = smoothstep(edge0, edge1, vec3(red, green, blue));\n\n        if(#INJECT(uInvert) == 1.0) {\n        fragColor = vec4(1.0 - smoothColor, 1.0);\n        } else {\n        fragColor = vec4(smoothColor, 1.0);\n        }\n    }\n    "),upVert:"#version 300 es\n    in vec2 co;\n    out vec2 vS;\n    void main(void) {\n        gl_Position = vec4(co, 0, 1);\n        vS = 0.5 + 0.5 * co;\n    }\n    ",resFrag:"#version 300 es        \n    precision mediump float;\n    uniform vec2 uPat;\n\n    in vec2 vS;\n    out vec4 fragColor;\n\n    ".concat(Ie,"\n    ").concat(Re,"\n\n    float random(vec2 st) {\n        return fract(sin(dot(st.xy, vec2(12.9898, 78.233))) * 43758.5453123);\n    }\n\n    void main() {\n        float width = 2160.0;\n        float height = 1620.0;\n      \n        float aspectRatio = width / height;\n        \n        const int numberOfDots = 50;\n        float dotRadius = 0.005;\n        \n        float starter = 0.0;\n        \n        for(int i = 0; i < numberOfDots; ++i) {\n            vec2 dotPos = vec2(\n                random(vec2(float(i), 0.12345)),\n                random(vec2(float(i), 0.67890))\n            );\n            \n            dotPos.x *= aspectRatio;\n            \n            float distToDot = distance(vS * vec2(aspectRatio, 1.0), dotPos);\n            if(distToDot < dotRadius) {\n                starter = 1.0;\n                break;\n            }\n        }\n        \n        const float A = 1.0;\n        float B = dot(uPat, vec2(starter, 0));\n        vec2 values = vec2(A, B);\n        \n        fragColor = en(values);\n    }\n    "),imageMapFrag:"#version 300 es\n    precision mediump float;\n\n    uniform sampler2D uPI;\n    uniform sampler2D uImageMapTexture;\n    uniform vec2 uTex;\n    uniform vec4 uSampledChannel;\n    uniform float uDiffuseScaling;\n    uniform float uEdgeInfluence;\n    uniform float uBrightnessInfluence;\n    uniform vec2 uBrushPosition;\n    uniform float uBrushSize;\n    uniform float uBrushStrength;\n    uniform vec2 uResolution;\n\n    in vec2 vS;\n    out vec4 fragColor;\n    ".concat(Ie,"\n    ").concat(Re,"\n\n    float luminance(vec3 color) {\n        return dot(color, vec3(0.299, 0.587, 0.114));\n    }\n\n    vec2 kernel(vec2 decodedCenter) {\n        return\n            de(texture(uPI, vS + vec2(-1, -1) * uTex)) * 0.05 +\n            de(texture(uPI, vS + vec2(+0, -1) * uTex)) * 0.20 +\n            de(texture(uPI, vS + vec2(+1, -1) * uTex)) * 0.05 +\n    \n            de(texture(uPI, vS + vec2(-1, +0) * uTex)) * 0.20 -\n            decodedCenter +\n            de(texture(uPI, vS + vec2(+1, +0) * uTex)) * 0.20 +\n    \n            de(texture(uPI, vS + vec2(-1, +1) * uTex)) * 0.05 +\n            de(texture(uPI, vS + vec2(+0, +1) * uTex)) * 0.20 +\n            de(texture(uPI, vS + vec2(+1, +1) * uTex)) * 0.05;\n    }\n\n    float detectEdges(sampler2D tex, vec2 uv, vec2 step) {\n        float tl = luminance(texture(tex, uv + vec2(-step.x, -step.y)).rgb);\n        float t  = luminance(texture(tex, uv + vec2(0.0, -step.y)).rgb);\n        float tr = luminance(texture(tex, uv + vec2(step.x, -step.y)).rgb);\n        float r  = luminance(texture(tex, uv + vec2(step.x, 0.0)).rgb);\n        float br = luminance(texture(tex, uv + vec2(step.x, step.y)).rgb);\n        float b  = luminance(texture(tex, uv + vec2(0.0, step.y)).rgb);\n        float bl = luminance(texture(tex, uv + vec2(-step.x, step.y)).rgb);\n        float l  = luminance(texture(tex, uv + vec2(-step.x, 0.0)).rgb);\n        float dX = (tr + 2.0 * r + br) - (tl + 2.0 * l + bl);\n        float dY = (bl + 2.0 * b + br) - (tl + 2.0 * t + tr);\n        return length(vec2(dX, dY));\n    }\n\n    void main() {\n    vec2 values = de(texture(uPI, vS));\n    float A = values.x;\n    float B = values.y;\n\n    vec4 sampledColor = texture(uImageMapTexture, vS);\n    float mapValue = dot(uSampledChannel, sampledColor);\n    \n    float brightness = luminance(sampledColor.rgb);\n    float edge = detectEdges(uImageMapTexture, vS, uTex);\n    \n    mapValue = mix(mapValue, 1.0, brightness * uBrightnessInfluence);\n    mapValue = mix(mapValue, 1.0, edge * uEdgeInfluence);\n    \n    float aspectRatio = uResolution.x / uResolution.y;\n\n    vec2 brushPos = uBrushPosition;\n    brushPos.x *= aspectRatio;\n    vec2 pixelPos = vS;\n    pixelPos.x *= aspectRatio;\n    float distToBrush = distance(pixelPos, brushPos) / aspectRatio;\n    float brushInfluence = smoothstep(uBrushSize, uBrushSize - 0.001, distToBrush);\n    \n    A = mix(A, 1.0, brushInfluence * uBrushStrength);\n    B = mix(B, 1.0, brushInfluence * uBrushStrength);\n\n    float feedA = mix(0.02220, 0.04470, mapValue);\n    float killB = mix(0.06516, 0.05789, mapValue);\n    \n    feedA = mix(feedA, feedA * (1.0 - brightness), uBrightnessInfluence);\n    killB = mix(killB, killB * (1.0 + brightness), uBrightnessInfluence);\n    \n    feedA = mix(feedA, feedA * (1.0 - edge), uEdgeInfluence);\n    killB = mix(killB, killB * (1.0 + edge), uEdgeInfluence);\n    \n    float diffA = 0.210;\n    float diffB = 0.105;\n\n    vec2 laplace = kernel(values);\n    float reaction = A * B * B;\n    const float dt = 1.0;\n    \n    A = A + dt * (uDiffuseScaling * diffA * laplace.x - reaction + feedA * (1.0 - A));\n    B = B + dt * (uDiffuseScaling * diffB * laplace.y + reaction - (killB + feedA) * B);\n\n    fragColor = en(vec2(A, B));\n    }\n    "),updateMapFrag:"#version 300 es\n    precision mediump float;\n    \n    uniform sampler2D uPI;\n    uniform vec2 uTex;\n    uniform vec2 uRates;\n    \n    in vec2 vS;\n    out vec4 fragColor;\n    ".concat(Ie,"\n    ").concat(Re,"\n    vec2 kernel(vec2 decodedCenter) {\n        return\n            de(texture(uPI, vS + vec2(-1, -1) * uTex)) * 0.05 +\n            de(texture(uPI, vS + vec2(+0, -1) * uTex)) * 0.20 +\n            de(texture(uPI, vS + vec2(+1, -1) * uTex)) * 0.05 +\n    \n            de(texture(uPI, vS + vec2(-1, +0) * uTex)) * 0.20 -\n            decodedCenter +\n            de(texture(uPI, vS + vec2(+1, +0) * uTex)) * 0.20 +\n        \n            de(texture(uPI, vS + vec2(-1, +1) * uTex)) * 0.05 +\n            de(texture(uPI, vS + vec2(+0, +1) * uTex)) * 0.20 +\n            de(texture(uPI, vS + vec2(+1, +1) * uTex)) * 0.05;\n    }\n\n    vec4 computeNewValue(const float feedA, const float killB, const float diffA, const float diffB) {\n        vec2 values = de(texture(uPI, vS));\n        vec2 laplace = kernel(values);\n    \n        float A = values.x;\n        float B = values.y;\n        float reaction = A * B * B;\n        const float dt = 1.0;\n        values = vec2(\n            values.x + dt * (diffA * laplace.x - reaction + feedA * (1.0 - A)),\n            values.y + dt * (diffB * laplace.y + reaction - (killB + feedA) * B)\n        );\n    \n        return en(values);\n    }\n    \n    void main() {\n        float feedA = mix(#INJECT(FEED_MIN), #INJECT(FEED_MAX), vS.y);\n        float killB = mix(#INJECT(KILL_MIN), #INJECT(KILL_MAX), vS.x);\n    \n        fragColor = computeNewValue(feedA, killB, uRates.x, uRates.y);\n    }")},Le=null,Pe=function(){return ve((function e(t){me(this,e),this._gl=t}),[{key:"gl",value:function(){return this._gl}}])}(),Be=function(e){function t(e,n,i){var r;me(this,t),(r=de(this,t,[e])).id=null,r.uCount=0,r.aCount=0,r.u={},r.a={};var o=r.createShader(e.VERTEX_SHADER,n),a=r.createShader(e.FRAGMENT_SHADER,i);return o&&a&&r.createProgram(o,a),r}return pe(t,e),ve(t,[{key:"createShader",value:function(e,t){var n=this.gl(),i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),n.getShaderParameter(i,n.COMPILE_STATUS)?i:(console.error(n.getShaderInfoLog(i)),n.deleteShader(i),null)}},{key:"createProgram",value:function(e,t){var n=this.gl(),i=n.createProgram();n.attachShader(i,e),n.attachShader(i,t),n.linkProgram(i),n.getProgramParameter(i,n.LINK_STATUS)?(this.id=i,this.introspection()):(console.error(n.getProgramInfoLog(i)),n.deleteProgram(i))}},{key:"use",value:function(){this.gl().useProgram(this.id)}},{key:"bindUniforms",value:function(){var e=this,t=this.gl(),n=0;Object.keys(this.u).forEach((function(i){var r=e.u[i];if(null!==r.value)if(r.type===t.SAMPLER_2D||r.type===t.SAMPLER_CUBE){var o=n;t.uniform1i(r.loc,o),t.activeTexture(t.TEXTURE0+o),t.bindTexture(t.TEXTURE_2D,r.value),n++}else r.type===t.FLOAT?t.uniform1f(r.loc,r.value):r.type===t.FLOAT_VEC2?t.uniform2fv(r.loc,r.value):r.type===t.FLOAT_VEC4?t.uniform4fv(r.loc,r.value):r.type===t.BOOL&&t.uniform1i(r.loc,r.value)}))}},{key:"bindAttributes",value:function(){var e=this;Object.keys(this.a).forEach((function(t){var n=e.a[t];null!==n.VBO&&n.VBO.bind(n.loc)}))}},{key:"bindUniformsAndAttributes",value:function(){this.bindUniforms(),this.bindAttributes()}},{key:"introspection",value:function(){var e=this.gl();this.uCount=e.getProgramParameter(this.id,e.ACTIVE_UNIFORMS),this.u={};for(var t=0;t<this.uCount;t++){var n=e.getActiveUniform(this.id,t),i=n.name;this.u[i]={loc:e.getUniformLocation(this.id,i),size:n.size,type:n.type,value:null}}this.aCount=e.getProgramParameter(this.id,e.ACTIVE_ATTRIBUTES),this.a={};for(var r=0;r<this.aCount;r++){var o=e.getActiveAttrib(this.id,r),a=o.name;this.a[a]={VBO:null,loc:e.getAttribLocation(this.id,a),size:o.size,type:o.type}}}}])}(Pe),Fe=function(e){function t(e,n,i,r){var o;return me(this,t),(o=de(this,t,[e])).id=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,o.id),e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),o.size=i,o.type=r,o.normalize=!1,o.stride=0,o.offset=0,o}return pe(t,e),ve(t,[{key:"bind",value:function(e){var n,i,r,o=(n=t,i=this,r=ce(fe(1&3?n.prototype:n),"gl",i),function(e){return r.apply(i,e)})([]);o.enableVertexAttribArray(e),o.bindBuffer(o.ARRAY_BUFFER,this.id),o.vertexAttribPointer(e,this.size,this.type,this.normalize,this.stride,this.offset)}}],[{key:"createQuad",value:function(e,n,i,r,o){return new t(e,new Float32Array([n,i,r,i,n,o,r,o]),2,e.FLOAT,!0)}}])}(Pe),De=function(){return ve((function e(){me(this,e),this.texture=Le.createTexture(),this.framebuffer=Le.createFramebuffer(),this._width=-1,this._height=-1}),[{key:"reserveSpace",value:function(e,t){if(e=Math.ceil(e),t=Math.ceil(t),this.width!==e||this.height!==t){Le.bindTexture(Le.TEXTURE_2D,this.texture);var n=Le.RGBA;Le.texImage2D(Le.TEXTURE_2D,0,n,e,t,0,n,Le.UNSIGNED_BYTE,null),Le.texParameteri(Le.TEXTURE_2D,Le.TEXTURE_MAG_FILTER,Le.LINEAR),Le.texParameteri(Le.TEXTURE_2D,Le.TEXTURE_MIN_FILTER,Le.LINEAR),Le.texParameteri(Le.TEXTURE_2D,Le.TEXTURE_WRAP_S,Le.CLAMP_TO_EDGE),Le.texParameteri(Le.TEXTURE_2D,Le.TEXTURE_WRAP_T,Le.CLAMP_TO_EDGE),Le.bindFramebuffer(Le.FRAMEBUFFER,this.framebuffer),Le.framebufferTexture2D(Le.FRAMEBUFFER,Le.COLOR_ATTACHMENT0,Le.TEXTURE_2D,this.texture,0),Le.bindFramebuffer(Le.FRAMEBUFFER,null),Le.bindTexture(Le.TEXTURE_2D,null),this._width=e,this._height=t}}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}])}(),Me=function(){return ve((function e(){me(this,e),this.previousTexture=new De,this.currentTexture=new De}),[{key:"previous",get:function(){return this.previousTexture.texture}},{key:"current",get:function(){return this.currentTexture.texture}},{key:"currentFramebuffer",get:function(){return this.currentTexture.framebuffer}},{key:"width",get:function(){return this.previousTexture.width}},{key:"height",get:function(){return this.previousTexture.height}},{key:"reserveSpace",value:function(e,t){this.previousTexture.reserveSpace(e,t),this.currentTexture.reserveSpace(e,t)}},{key:"swap",value:function(){var e=[this.previousTexture,this.currentTexture];this.currentTexture=e[0],this.previousTexture=e[1]}}])}(),Ne=function(){function e(){me(this,e),this.lastUpdateTimestamp=0,this.targetWidth=1,this.targetHeight=1,this.squareVBO=null,this.vao=null,this.internalTextures=[new Me,new Me,new Me],this.needToReset=!0,this.lastIterationUpdate=performance.now()-5e3,this._iteration=0,this.brush={position:[0,0],size:.05,strength:.5,isDrawing:!1},this.initializeVAO(),this.loadShaders(),this.setupBrushListeners()}return ve(e,[{key:"initializeVAO",value:function(){this.vao=Le.createVertexArray(),Le.bindVertexArray(this.vao),this.squareVBO=Fe.createQuad(Le,-1,-1,1,1),Le.bindVertexArray(null)}},{key:"loadShaders",value:function(){var t=this;this.asyncLoadShader("display-tricolor",Oe.disVert,Oe.disColFrag,(function(e){t.displayTricolorShader=e}),{uInvert:e.uInvert.toFixed(1)}),this.asyncLoadShader("update-map",Oe.upVert,Oe.updateMapFrag,(function(e){t.updateMapShader=e}),{FEED_MIN:e.FEED_MIN.toFixed(5),FEED_MAX:e.FEED_MAX.toFixed(5),KILL_MIN:e.KILL_MIN.toFixed(5),KILL_MAX:e.KILL_MAX.toFixed(5)}),this.asyncLoadShader("update-image",Oe.upVert,Oe.imageMapFrag,(function(e){t.updateImageMapShader=e})),this.asyncLoadShader("reset",Oe.upVert,Oe.resFrag,(function(e){t.resetShader=e}),{PATTERN_SPLIT:"int(".concat(Te.patternSplit,")")})}},{key:"restart",value:function(){this.needToReset=!0,this._iteration=0,this.lastIterationUpdate=performance.now()-5e3,this.lastUpdateTimestamp=0;var e,t=ue(this.internalTextures);try{for(t.s();!(e=t.n()).done;)e.value.reserveSpace(this.targetWidth,this.targetHeight)}catch(e){t.e(e)}finally{t.f()}this.clearInternalTextures()}},{key:"setupBrushListeners",value:function(){var e=this,t=Le.canvas,n=function(n){var i=t.getBoundingClientRect(),r=t.width/i.width,o=t.height/i.height,a=(n.clientX-i.left)*r/t.width,s=1-(n.clientY-i.top)*o/t.height;e.brush.position=[a,s]};t.addEventListener("mousedown",(function(t){e.brush.isDrawing=!0,n(t)})),t.addEventListener("mousemove",(function(e){n(e)})),t.addEventListener("mouseup",(function(){e.brush.isDrawing=!1})),t.addEventListener("mouseout",(function(){e.brush.isDrawing=!1})),t.addEventListener("touchstart",(function(t){t.preventDefault(),e.brush.isDrawing=!0,n(t.touches[0])})),t.addEventListener("touchmove",(function(e){e.preventDefault(),n(e.touches[0])})),t.addEventListener("touchend",(function(){e.brush.isDrawing=!1}))}},{key:"resize",value:function(e,t){this.targetWidth=e,this.targetHeight=t}},{key:"reset",value:function(){this.needToReset=!0}},{key:"drawToCanvas",value:function(){Le.bindVertexArray(this.vao),Le.viewport(0,0,this.targetWidth,this.targetHeight);var e=this.displayTricolorShader;if(e){e.use(),e.u.uR.value=this.internalTextures[0].current,e.u.uG.value=this.internalTextures[1].current,e.u.uB.value=this.internalTextures[2].current;var t=this.targetWidth/this.targetHeight,n=this.internalTextures[0].width/this.internalTextures[0].height;e.u.s.value=[n/t,1],e.u.z.value=Te.zoom,Le.bindFramebuffer(Le.FRAMEBUFFER,null),e.bindUniformsAndAttributes(),Le.drawArrays(Le.TRIANGLE_STRIP,0,4)}Le.bindVertexArray(null)}},{key:"update",value:function(){if(this.adjustInternalTextureSize()&&(this.needToReset=!0),Le.viewport(0,0,this.internalTextures[0].width,this.internalTextures[0].height),this.needToReset){if(this.iteration=0,!this.clearInternalTextures())return;this.needToReset=!1}var e=this.computeNbIterationsForThisFrame();if(!(e<=0)&&"image"===Te.interface&&this.updateImageMapShader){var t=Ve();this.updateImageMapShader.use(),this.updateImageMapShader.u.uImageMapTexture.value=t.id,this.updateImageMapShader.u.uDiffuseScaling.value=Te.randomPatternScale,this.updateImageMapShader.u.uTex.value=[1/this.internalTextures[0].width,1/this.internalTextures[0].height],this.updateImageMapShader.u.uEdgeInfluence.value=Te.edgeInfluence,this.updateImageMapShader.u.uBrightnessInfluence.value=Te.brightnessInfluence,this.updateImageMapShader.u.uResolution.value=[this.targetWidth,this.targetHeight],this.updateImageMapShader.u.uBrushPosition.value=this.brush.position,this.updateImageMapShader.u.uBrushSize.value=Te.brushSize,this.updateImageMapShader.u.uBrushStrength.value=this.brush.isDrawing?Te.brushStrength:0,this.updateImageMapShader.bindAttributes();var n=Math.ceil(e/3);this.updateImageMapShader.u.uSampledChannel.value=[1,0,0,0],this.updateInternal(this.updateImageMapShader,n,this.internalTextures[0]),this.updateImageMapShader.u.uSampledChannel.value=[0,1,0,0],this.updateInternal(this.updateImageMapShader,n,this.internalTextures[1]),this.updateImageMapShader.u.uSampledChannel.value=[0,0,1,0],this.updateInternal(this.updateImageMapShader,n,this.internalTextures[2])}}},{key:"updateInternal",value:function(e,t,n){Le.bindVertexArray(this.vao);for(var i=t;i>0;i--)n.swap(),Le.bindFramebuffer(Le.FRAMEBUFFER,n.currentFramebuffer),e.u.uPI.value=n.previous,e.bindUniforms(),Le.drawArrays(Le.TRIANGLE_STRIP,0,4);Le.bindVertexArray(null),this.iteration=this._iteration+t}},{key:"clearInternalTextures",value:function(){if(this.resetShader){Le.bindVertexArray(this.vao);var e=Te.initState;this.resetShader.u.uPat.value=["starter"===e,0],this.resetShader.use(),this.resetShader.bindUniformsAndAttributes();var t,n=ue(this.internalTextures);try{for(n.s();!(t=n.n()).done;){var i=t.value;Le.bindFramebuffer(Le.FRAMEBUFFER,i.currentFramebuffer),Le.drawArrays(Le.TRIANGLE_STRIP,0,4)}}catch(e){n.e(e)}finally{n.f()}return Le.bindVertexArray(null),!0}return!1}},{key:"adjustInternalTextureSize",value:function(){var e=this.targetWidth,t=this.targetHeight;if("image"===Te.interface){var n=this.targetWidth/this.targetHeight,i=Ve().width/Ve().height;n>i?e=Math.ceil(i/n*this.targetWidth):n<i&&(t=Math.ceil(n/i*this.targetHeight))}if(this.internalTextures[0].width!==e||this.internalTextures[0].height!==t){var r,o=ue(this.internalTextures);try{for(o.s();!(r=o.n()).done;)r.value.reserveSpace(e,t)}catch(e){o.e(e)}finally{o.f()}return!0}return!1}},{key:"iteration",set:function(e){this._iteration=e;var t=performance.now();t-this.lastIterationUpdate>200&&(this.lastIterationUpdate=t)}},{key:"computeNbIterationsForThisFrame",value:function(){var e=Te.speed,t=performance.now(),n=1e3/(.1+t-this.lastUpdateTimestamp);return this.lastUpdateTimestamp=t,n>60?Math.ceil(60/n*e):n<10?Math.ceil(n/10*e):e}},{key:"asyncLoadShader",value:function(e,t,n,i){var r=this;!function(e,t){var n=e.vertexSource,i=e.fragmentSource,r=e.injected,o=n?n.replace(/#INJECT\(([^)]*)\)/gm,(function(e,t){return r[t]||e})):null,a=i?i.replace(/#INJECT\(([^)]*)\)/gm,(function(e,t){return r[t]||e})):null,s=null;o&&a&&(s=new Be(Le,o,a)),t(s)}({fragmentSource:n,vertexSource:t,injected:arguments.length>4&&void 0!==arguments[4]?arguments[4]:{}},(function(t){null!==t?(t.a.co.VBO=r.squareVBO,i(t)):console.error("Failed to build '".concat(e,"' shader."))}))}}])}();Ne.FEED_MIN=.01,Ne.FEED_MAX=.1,Ne.KILL_MIN=.045,Ne.KILL_MAX=.07,Ne.uInvert=Te.invert;var Ue=null;function Ve(){return null===Ue&&(Ue=new He(new ImageData(new Uint8ClampedArray([0,0,0,255]),1,1))),Ue}var He=function(){return ve((function e(t){me(this,e),this._width=t.width||-1,this._height=t.height||-1,this.id=Le.createTexture(),this.uploadToGPU(t)}),[{key:"uploadToGPU",value:function(e){if(e)if(this._width=e.width||e.videoWidth||-1,this._height=e.height||e.videoHeight||-1,this._width<=0||this._height<=0)console.error("Invalid dimensions for texture source",{width:this._width,height:this._height});else{Le.bindTexture(Le.TEXTURE_2D,this.id),Le.texParameteri(Le.TEXTURE_2D,Le.TEXTURE_WRAP_S,Le.CLAMP_TO_EDGE),Le.texParameteri(Le.TEXTURE_2D,Le.TEXTURE_WRAP_T,Le.CLAMP_TO_EDGE),Le.texParameteri(Le.TEXTURE_2D,Le.TEXTURE_MIN_FILTER,Le.LINEAR),Le.texParameteri(Le.TEXTURE_2D,Le.TEXTURE_MAG_FILTER,Le.LINEAR);try{Le.texImage2D(Le.TEXTURE_2D,0,Le.RGBA,Le.RGBA,Le.UNSIGNED_BYTE,e)}catch(e){console.error("Error uploading texture to GPU",e)}Le.bindTexture(Le.TEXTURE_2D,null)}else console.error("Invalid source provided to uploadToGPU")}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}])}();function je(){var e=new oe({autoPlace:!1}),t=document.querySelector("#gui");t.appendChild(e.domElement),t.style.position="absolute",t.style.top="10px",t.style.right="10px",t.style.zIndex="1000",e.add(Te,"zoom",1,5).onChange((function(e){Te.zoom=e})),e.add(Te,"speed",1,120).step(1).onChange((function(e){Te.speed=e})),e.add(Te,"contrast",0,150).step(1).onChange((function(e){Te.contrast=e})),e.add(Te,"randomPatternScale",1,5.3).onChange((function(e){Te.randomPatternScale=e})),e.add(Te,"edgeInfluence",-1,1).step(.01).onChange((function(e){Te.edgeInfluence=e})),e.add(Te,"brightnessInfluence",-.25,.25).step(.001).onChange((function(e){Te.brightnessInfluence=e})),e.add(Te,"invert").onChange((function(e){Te.invert=e?1:0,document.body.style.backgroundColor=1===Te.invert?"white":"black"})),e.add(Te,"brushSize",.001,.1).onChange((function(e){Te.brushSize=e})),e.add(Te,"brushStrength",0,1).onChange((function(e){Te.brushStrength=e}));var n=e.addFolder("Camera");return n.add(Te,"zoomCam",.5,3).step(.1).onChange((function(e){Te.zoomCam=e,Ae&&Ae.setZoom(e)})),n.open(),e.add({saveImage:function(){!function(){var e=document.createElement("canvas");e.width=Se.width,e.height=Se.height,e.getContext("2d").drawImage(Se,0,0,Se.width,Se.height);var t=e.toDataURL("image/png"),n=document.createElement("a");n.href=t,n.download="reaction_diffusion_"+Date.now()+".png",document.body.appendChild(n),n.click(),document.body.removeChild(n)}()}},"saveImage").name("Save Image"),e.add({splitAndSaveColors:function(){!function(){var e=document.createElement("canvas");e.width=Se.width,e.height=Se.height;var t=e.getContext("2d");t.drawImage(Se,0,0,Se.width,Se.height);var n=t.getImageData(0,0,Se.width,Se.height).data;["red","green","blue"].forEach((function(e,t){var i=document.createElement("canvas");i.width=Se.width,i.height=Se.height;for(var r=i.getContext("2d"),o=r.createImageData(Se.width,Se.height),a=o.data,s=0;s<n.length;s+=4)a[s]=n[s+t],a[s+1]=n[s+t],a[s+2]=n[s+t],a[s+3]=255;r.putImageData(o,0,0);var u=i.toDataURL("image/png"),l=document.createElement("a");l.href=u,l.download="reaction_diffusion_".concat(e,"_").concat(Date.now(),".png"),document.body.appendChild(l),l.click(),document.body.removeChild(l)}))}()}},"splitAndSaveColors").name("Split & Save Colors"),e.add({splitAndSaveSVG:function(){!function(){var e=document.createElement("canvas");e.width=Se.width,e.height=Se.height;var t=e.getContext("2d");t.drawImage(Se,0,0,Se.width,Se.height);var n=t.getImageData(0,0,Se.width,Se.height);["red","green","blue"].forEach((function(e,t){var i=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:128,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,r=e.width,o=e.height,a=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:128,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,r=e.width,o=e.height,a=[],s="",u=0;u<o;u+=i){for(var l=!1,c=0;c<r;c+=i){var d=4*(u*r+c);e.data[d+t]<n?l?s+="L".concat(c,",").concat(u):(s+="M".concat(c,",").concat(u),l=!0):l&&(a.push(s),s="",l=!1)}l&&(a.push(s),s="")}for(var h=0;h<r;h+=i){for(var f=!1,p=0;p<o;p+=i){var _=4*(p*r+h);e.data[_+t]<n?f?s+="L".concat(h,",").concat(p):(s+="M".concat(h,",").concat(p),f=!0):f&&(a.push(s),s="",f=!1)}f&&(a.push(s),s="")}return a}(e,t,n,i),s='<svg xmlns="http://www.w3.org/2000/svg" width="'.concat(r,'" height="').concat(o,'">');return(s+='<path d="'.concat(a.join(" "),'" fill="none" stroke="black" stroke-width="1" />'))+"</svg>"}(n,t),r=new Blob([i],{type:"image/svg+xml"}),o=URL.createObjectURL(r),a=document.createElement("a");a.href=o,a.download="reaction_diffusion_".concat(e,"_").concat(Date.now(),".svg"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}))}()}},"splitAndSaveSVG").name("Split & Save as SVG"),e.add({restartSimulation:function(){Ee&&Ee.restart()}},"restartSimulation").name("Restart"),e}function ze(){return(ze=ye(ae().mark((function e(){var t,n,i,r;return ae().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=function(){n&&(2160===Se.width&&1620===Se.height||(Se.width=2160,Se.height=1620),Ee.resize(Se.width,Se.height),n=!1),ke(),Ee.needToReset&&(Ee.clearInternalTextures(),Ee.needToReset=!1),Ee.updateImageMapShader.u.uDiffuseScaling.value=Te.randomPatternScale,Ee.updateImageMapShader.u.uEdgeInfluence.value=Te.edgeInfluence,Ee.updateImageMapShader.u.uBrightnessInfluence.value=Te.brightnessInfluence,Ee.update(),Ee.drawToCanvas(),requestAnimationFrame(r)},t={alpha:!1,antialias:!1,depth:!1,stencil:!1,preserveDrawingBuffer:!0},Le=Se.getContext("webgl2",t)){e.next=6;break}return console.error("Unable to create WebGL 2.0 context. Your browser may not support it."),e.abrupt("return");case 6:Le.clearColor(1,1,1,1),Le.disable(Le.CULL_FACE),Le.disable(Le.BLEND),Le.disable(Le.DEPTH_TEST),Le.disable(Le.STENCIL_TEST),n=!0,Ee=new Ne,Se.width=Te.canvasWidth,Se.height=Te.canvasHeight,i=Math.min(window.innerWidth/Te.canvasWidth,window.innerHeight/Te.canvasHeight),Se.style.width="".concat(Te.canvasWidth*i,"px"),Se.style.height="".concat(Te.canvasHeight*i,"px"),Ve(),je(),r();case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(function(){return ze.apply(this,arguments)})().catch(console.error)})();